@model IEnumerable<N16_MilkTea.Models.DoUong>

@{
    ViewData["Title"] = "Thực đơn";
    
    // Lấy danh sách danh mục từ Controller
    var listDanhMuc = ViewBag.DanhMucs as List<N16_MilkTea.Models.DanhMuc>;

    // Nhóm sản phẩm theo Mã Danh Mục (int) thay vì Tên (string) để tránh lỗi
    var groups = Model.GroupBy(x => x.MaDanhMuc);
}

<div class="bg-success text-white text-center py-5 mb-4">
    <h1 class="display-4 fw-bold">Thực Đơn N16</h1>
    <p class="lead">Khám phá thế giới hương vị đa dạng của chúng tôi</p>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-3 d-none d-md-block">
            <div class="list-group sticky-top" style="top: 100px; z-index: 1;">
                <a href="#" class="list-group-item list-group-item-action active bg-success border-success">Danh mục</a>
                @foreach (var group in groups)
                {
                    // Tìm tên danh mục dựa vào Mã
                    string tenDm = "Khác";
                    if (listDanhMuc != null)
                    {
                        var dm = listDanhMuc.FirstOrDefault(d => d.MaDanhMuc == group.Key);
                        if (dm != null) tenDm = dm.TenDanhMuc;
                    }

                    <a href="#cat-@group.Key" class="list-group-item list-group-item-action">@tenDm</a>
                }
            </div>
        </div>

        <div class="col-md-9">
            @foreach (var group in groups)
            {
                // Tìm tên danh mục để hiển thị tiêu đề
                string tenDm = "Khác";
                if (listDanhMuc != null)
                {
                    var dm = listDanhMuc.FirstOrDefault(d => d.MaDanhMuc == group.Key);
                    if (dm != null) tenDm = dm.TenDanhMuc;
                }

                <div id="cat-@group.Key" class="mb-5">
                    <h3 class="text-success border-bottom pb-2 mb-3">@tenDm</h3>
                    
                    <div class="row row-cols-1 row-cols-md-2 g-4">
                        @foreach (var item in group)
                        {
                            decimal giaMin = item.DoUongSizes.Any() ? item.DoUongSizes.Min(s => s.Gia) : 0;
                            
                            <div class="col">
                                <div class="card h-100 shadow-sm border-0 d-flex flex-row align-items-center p-2">
                                    <img src="~/images/@item.HinhAnh" 
                                         class="rounded" 
                                         style="width: 100px; height: 100px; object-fit: cover;"
                                         onerror="this.src='https://placehold.co/100'">
                                    
                                    <div class="card-body py-0 px-3">
                                        <h5 class="card-title fw-bold mb-1">
                                            <a asp-action="Details" asp-route-id="@item.MaDoUong" class="text-decoration-none text-dark stretched-link">
                                                @item.TenDoUong
                                            </a>
                                        </h5>
                                        <p class="text-muted small mb-1 text-truncate" style="max-width: 200px;">@item.MoTa</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="text-success fw-bold">@giaMin.ToString("#,##0") đ</span>
                                            <button class="btn btn-sm btn-outline-success rounded-circle">
                                                <i class="bi bi-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div>